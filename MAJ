local p = game:GetService("Players").LocalPlayer
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local isHolding = false

-- [[ 偵測觸控開始 ]]
UIS.InputBegan:Connect(function(input, gpe)
    -- 判斷是否為觸控動作
    if input.UserInputType == Enum.UserInputType.Touch or input.KeyCode == Enum.KeyCode.Space then
        -- 如果是按下跳躍按鈕觸發的 (GPE = GameProcessedEvent)
        -- 或者直接偵測 Humanoid.Jump (最直接的手機端回傳)
        isHolding = true
    end
end)

-- [[ 偵測觸控結束 ]]
UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch or input.KeyCode == Enum.KeyCode.Space then
        isHolding = false
    end
end)

-- [[ 核心循環：只要 isHolding 為 true 就無限起跳 ]]
RS.Heartbeat:Connect(function()
    local char = p.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    
    if hum then
        -- 核心邏輯：如果偵測到手動跳躍，立刻將狀態設為 Holding
        if hum.Jump then
            isHolding = true
        end

        -- 只要按住且落地，就強制起跳
        if isHolding and hum.FloorMaterial ~= Enum.Material.Air then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)
