local p = game:GetService("Players").LocalPlayer
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local holdingJump = false

-- [[ 偵測按鈕按下與放開 ]]
UIS.InputBegan:Connect(function(input, gpe)
    -- Space 是鍵盤，ButtonA 是手把，Touch 是手機螢幕
    if input.KeyCode == Enum.KeyCode.Space or input.UserInputType == Enum.UserInputType.Touch then
        -- 判斷是否點擊在跳躍按鈕的區域 (簡化邏輯：只要有跳躍動作就視為 Hold)
        if game:GetService("GuiService").SelectedObject == nil then
            holdingJump = true
        end
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.Space or input.UserInputType == Enum.UserInputType.Touch then
        holdingJump = false
    end
end)

-- [[ 核心循環 ]]
RS.Heartbeat:Connect(function()
    local char = p.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")

    if hum then
        -- 如果玩家正在按住按鈕 (holdingJump) 且 偵測到 Humanoid.Jump 被觸發
        -- 或者 Humandoid 本身就在跳躍狀態
        if hum.Jump then
            holdingJump = true
        end

        if holdingJump then
            -- 只要落地，就立刻強制進入跳躍狀態
            if hum.FloorMaterial ~= Enum.Material.Air then
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
end)
