local p = game:GetService("Players").LocalPlayer
local RS = game:GetService("RunService")

-- 取得手機跳躍按鈕的函式
local function getJumpButton()
    local touchGui = p:FindFirstChild("PlayerGui") and p.PlayerGui:FindFirstChild("TouchGui")
    if touchGui then
        return touchGui:FindFirstChild("JumpButton", true) -- 在 TouchGui 內遞迴尋找按鈕
    end
    return nil
end

RS.Heartbeat:Connect(function()
    local char = p.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    local jumpBtn = getJumpButton()

    if hum and jumpBtn then
        -- [[ 核心邏輯 ]]
        -- 1. 偵測 UI 按鈕是否被按下：
        -- 手機按鈕被按下時，ImageTransparency 通常會從 0.5 變為 0.8 (依版本而定)
        -- 最準確的方法是偵測按鈕的內建屬性或 Jump 訊號
        
        if hum.Jump or (jumpBtn.Active and jumpBtn.ImageTransparency > 0.5) then
            -- 如果人在地上，立刻起跳
            if hum.FloorMaterial ~= Enum.Material.Air then
                hum:ChangeState(Enum.HumanoidStateType.Jumping)
            end
        end
    end
end)
