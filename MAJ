local p = game:GetService("Players").LocalPlayer
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")
local guiService = game:GetService("GuiService")

local isHoldingJumpButton = false

-- 檢查觸碰位置是否有跳躍按鈕
local function isTouchingJumpButton(pos)
    local guis = p.PlayerGui:GetGuiObjectsAtPosition(pos.X, pos.Y)
    for _, gui in ipairs(guis) do
        if gui.Name == "JumpButton" then
            return true
        end
    end
    return false
end

-- 監控按下的位置
UIS.InputBegan:Connect(function(input, gpe)
    if input.UserInputType == Enum.UserInputType.Touch then
        if isTouchingJumpButton(input.Position) then
            isHoldingJumpButton = true
        end
    end
end)

-- 監控放開
UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        -- 為了保險，放開任何觸控都檢查是否要停止（或可針對特定 InputObject）
        isHoldingJumpButton = false
    end
end)

-- 核心循環
RS.Heartbeat:Connect(function()
    local char = p.Character
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    
    if hum then
        -- 額外補險：如果系統偵測到跳躍屬性，也視為按住按鈕
        if hum.Jump then
            isHoldingJumpButton = true
        end

        -- 執行連跳
        if isHoldingJumpButton and hum.FloorMaterial ~= Enum.Material.Air then
            hum:ChangeState(Enum.HumanoidStateType.Jumping)
        end
    end
end)
