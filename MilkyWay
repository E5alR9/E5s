-- [[ ğŸŒŒ éŠ€æ²³ç³» 7.0 - 15,000 é¡† ç•°æ¨£å°ºå¯¸ç‰ˆ ]]
local Lighting = game:GetService("Lighting")
local p = game:GetService("Players").LocalPlayer
local galaxyTag = "E5_Galaxy_RealScale"

local existing = workspace:FindFirstChild(galaxyTag)
if existing then
    _G.galaxyActive = false
    existing:Destroy()
    
    if _G.oldLighting then
        Lighting.ClockTime = _G.oldLighting.Time
        Lighting.Brightness = _G.oldLighting.Brightness
        Lighting.OutdoorAmbient = _G.oldLighting.Outdoor
        if _G.oldAtmosphere then _G.oldAtmosphere.Parent = Lighting end
    end
    print("Environment Restored.")
    return 
else
    _G.galaxyActive = true
    _G.oldLighting = {
        Time = Lighting.ClockTime,
        Brightness = Lighting.Brightness,
        Outdoor = Lighting.OutdoorAmbient
    }
    _G.oldAtmosphere = Lighting:FindFirstChildOfClass("Atmosphere")
    if _G.oldAtmosphere then _G.oldAtmosphere.Parent = nil end

    -- å®‡å®™é»‘åŒ–ç’°å¢ƒ
    Lighting.ClockTime = 0
    Lighting.Brightness = 0
    Lighting.OutdoorAmbient = Color3.fromRGB(0, 0, 0)

    local container = Instance.new("Model", workspace)
    container.Name = galaxyTag

    local stars = {}
    local starCount = 15000 
    
    local colorPalette = {
        Core = Color3.fromRGB(255, 245, 200),
        Inner = Color3.fromRGB(255, 255, 255),
        Arm = Color3.fromRGB(160, 210, 255),
        Dust = Color3.fromRGB(180, 140, 255)
    }

    for i = 1, starCount do
        local prt = Instance.new("Part", container)
        
        -- ã€æ™ºèƒ½å°ºå¯¸åˆ†é…ã€‘
        local sizeRand = math.random()
        local baseSize
        if sizeRand > 0.98 then
            baseSize = 3.5 + (math.random() * 1.5) -- 2% çš„å·¨æ˜Ÿ (ç½•è¦‹)
        elseif sizeRand > 0.85 then
            baseSize = 1.8 + (math.random() * 1.0) -- 13% çš„ä¸­å‹æ†æ˜Ÿ
        else
            baseSize = 0.4 + (math.random() * 0.8) -- 85% çš„å¾®å°æ˜Ÿé» (èƒŒæ™¯)
        end
        
        prt.Shape, prt.Size = Enum.PartType.Ball, Vector3.new(baseSize, baseSize, baseSize)
        prt.Material, prt.Anchored, prt.CanCollide = Enum.Material.Neon, true, false
        
        local ratio = i / starCount
        local radius = 30 + (math.pow(ratio, 0.8) * 500)
        local d = radius / 530
        
        -- é¡è‰²æ’å€¼è¨ˆç®—
        local finalColor
        if d < 0.2 then
            finalColor = colorPalette.Core:lerp(colorPalette.Inner, d/0.2)
        elseif d < 0.65 then
            finalColor = colorPalette.Inner:lerp(colorPalette.Arm, (d-0.2)/0.45)
        else
            finalColor = colorPalette.Arm:lerp(colorPalette.Dust, (d-0.65)/0.35)
        end
        prt.Color = finalColor

        table.insert(stars, {
            Obj = prt,
            Rad = radius,
            Angle = (i % 2) * math.pi + (radius * 0.012),
            OffX = (math.random() - 0.5) * (radius * 0.28),
            OffZ = (math.random() - 0.5) * (radius * 0.28),
            H = (math.random() - 0.5) * (80 * (1 - d)),
            Speed = (0.2 / (math.sqrt(radius) + 18)) * (0.8 + math.random() * 0.4)
        })
    end

    task.spawn(function()
        local t = 0
        local tilt = CFrame.Angles(math.rad(12), 0, math.rad(5))
        while _G.galaxyActive and container.Parent do
            t = t + 0.3
            local root = p.Character and p.Character:FindFirstChild("HumanoidRootPart")
            if root then
                local center = root.Position + Vector3.new(0, 280, 0)
                for _, data in ipairs(stars) do
                    local curA = data.Angle + (t * data.Speed)
                    local pos = Vector3.new(math.cos(curA) * data.Rad + data.OffX, data.H, math.sin(curA) * data.Rad + data.OffZ)
                    data.Obj.Position = center + (tilt * pos)
                end
            end
            task.wait()
        end
    end)
    print("Galaxy V7: Dynamic Scaling Active. [15k Stars]")
end
