local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local p = Players.LocalPlayer
local pGui = p:WaitForChild("PlayerGui")

-- 建立一個專用的 UI 容器
local freezeSystemGui = Instance.new("ScreenGui")
freezeSystemGui.Name = "SpecificLagSystem"
freezeSystemGui.ResetOnSpawn = false
freezeSystemGui.Parent = pGui

-- 通用拖移處理函式
local function applyDraggable(btn, onClick)
    local dragging, dragStart, startPos = false, nil, nil
    local pressStartTime = 0
    
    btn.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = btn.Position
            pressStartTime = tick()
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            if tick() - pressStartTime > 0.3 then
                local delta = input.Position - dragStart
                btn.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
            end
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = false
            if tick() - pressStartTime < 0.3 then 
                onClick() 
            end
        end
    end)
end

-- 1. 卡頓按鈕 (LAG ONCE)
local lagBtn = Instance.new("TextButton")
lagBtn.Name = "LagButton"
lagBtn.Size = UDim2.new(0, 90, 0, 45)
lagBtn.Position = UDim2.new(0.96, 0, 0.45, 0)
lagBtn.AnchorPoint = Vector2.new(1, 0.5)
lagBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
lagBtn.BackgroundTransparency = 0.4
lagBtn.Text = "LAG ONCE"
lagBtn.TextColor3 = Color3.new(1, 1, 1)
lagBtn.Font = Enum.Font.SourceSansBold
lagBtn.TextSize = 14
lagBtn.Parent = freezeSystemGui
Instance.new("UICorner", lagBtn).CornerRadius = UDim.new(0, 8)

applyDraggable(lagBtn, function()
    task.spawn(function()
        lagBtn.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
        lagBtn.Text = "FREEZING"
        
        local t = os.clock()
        while os.clock() - t < 0.3 do end
        
        lagBtn.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        lagBtn.Text = "LAG ONCE"
    end)
end)

-- 2. 清除按鈕 (CLOSE)
local closeBtn = Instance.new("TextButton")
closeBtn.Name = "CloseButton"
closeBtn.Size = UDim2.new(0, 70, 0, 35)
closeBtn.Position = UDim2.new(0.96, 0, 0.52, 0) -- 放在 LAG 按鈕正下方
closeBtn.AnchorPoint = Vector2.new(1, 0.5)
closeBtn.BackgroundColor3 = Color3.fromRGB(150, 0, 0)
closeBtn.BackgroundTransparency = 0.4
closeBtn.Text = "CLOSE"
closeBtn.TextColor3 = Color3.new(1, 1, 1)
closeBtn.Font = Enum.Font.SourceSansBold
closeBtn.TextSize = 14
closeBtn.Parent = freezeSystemGui
Instance.new("UICorner", closeBtn).CornerRadius = UDim.new(0, 8)

applyDraggable(closeBtn, function()
    -- 只刪除這個腳本建立的 UI 容器
    freezeSystemGui:Destroy()
end)
