local Lighting = game:GetService("Lighting")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer

------------------------------------------
-- 1. 全圖高亮切換
------------------------------------------
if _G.OriginalSettings == nil then
    _G.OriginalSettings = {
        Ambient = Lighting.Ambient,
        OutdoorAmbient = Lighting.OutdoorAmbient,
        Brightness = Lighting.Brightness,
        ClockTime = Lighting.ClockTime,
        FogEnd = Lighting.FogEnd,
        GlobalShadows = Lighting.GlobalShadows
    }
end

if _G.NightVisionEnabled == nil then _G.NightVisionEnabled = false end
_G.NightVisionEnabled = not _G.NightVisionEnabled

if _G.NightVisionEnabled then
    Lighting.Ambient = Color3.fromRGB(255, 255, 255)
    Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
    Lighting.Brightness = 3
    Lighting.ClockTime = 14
    Lighting.FogEnd = 100000
    Lighting.GlobalShadows = false
    print("L: ON")
else
    local orig = _G.OriginalSettings
    Lighting.Ambient = orig.Ambient
    Lighting.OutdoorAmbient = orig.OutdoorAmbient
    Lighting.Brightness = orig.Brightness
    Lighting.ClockTime = orig.ClockTime
    Lighting.FogEnd = orig.FogEnd
    Lighting.GlobalShadows = orig.GlobalShadows
    print("L: OFF")
end

------------------------------------------
-- 2. 物理控制 (R鍵加速 & 空格升空)
------------------------------------------
if _G.MainLoop then _G.MainLoop:Disconnect() end

local MOVE_SPEED = 1.5 -- R 鍵位移速度 (覺得太慢可改大)
local UP_SPEED = 0.1   -- 空格鍵上升速度 (慢慢往上)

local isPressingR = false
local isPressingSpace = false

-- 監聽按鍵開始
UserInputService.InputBegan:Connect(function(input, processed)
    if processed then return end
    if input.KeyCode == Enum.KeyCode.R then
        isPressingR = true
    elseif input.KeyCode == Enum.KeyCode.Space then
        isPressingSpace = true
    end
end)

-- 監聽按鍵結束
UserInputService.InputEnded:Connect(function(input)
    if input.KeyCode == Enum.KeyCode.R then
        isPressingR = false
    elseif input.KeyCode == Enum.KeyCode.Space then
        isPressingSpace = false
    end
end)

-- 核心物理循環
_G.MainLoop = RunService.Stepped:Connect(function()
    local char = player.Character
    local hrp = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChildOfClass("Humanoid")
    
    if hrp and hum then
        -- 處理 R 鍵位移 (無視蹲下)
        if isPressingR and hum.MoveDirection.Magnitude > 0 then
            hrp.CFrame = hrp.CFrame + (hum.MoveDirection * MOVE_SPEED)
        end
        
        -- 處理空格鍵慢慢往上 (Fly/Float)
        if isPressingSpace then
            -- 抵消重力並緩慢向上移動
            hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z) -- 鎖定垂直動量
            hrp.CFrame = hrp.CFrame * CFrame.new(0, UP_SPEED, 0)
        end
    end
end)

print(" R S")
