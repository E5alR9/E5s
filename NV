local Lighting = game:GetService("Lighting")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local VirtualInputManager = game:GetService("VirtualInputManager")
local player = Players.LocalPlayer

------------------------------------------
-- 1. UI é¡¯ç¤º/éš±è—åˆ‡æ›
------------------------------------------
local existingUI = game.CoreGui:FindFirstChild("Gemini_Ultimate_UI")
if existingUI then
    existingUI.Enabled = not existingUI.Enabled
    return 
end

------------------------------------------
-- 2. åˆå§‹åŒ–åƒæ•¸
------------------------------------------
_G.NightVisionEnabled = true
_G.BrightnessValue = _G.BrightnessValue or 0
_G.MoveSpeed = _G.MoveSpeed or 1.7
_G.UpSpeed = _G.UpSpeed or 0.3
_G.AutoClicker = false
_G.SelectedSubject = player.Name
_G.SelectedTarget = nil
_G.IsPressingR = false
_G.IsUpActive = false -- çµ±ä¸€ç®¡ç† Space èˆ‡ T çš„ç‹€æ…‹

------------------------------------------
-- 3. å»ºç«‹ UI ä»‹é¢
------------------------------------------
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "Gemini_Ultimate_UI"; screenGui.ResetOnSpawn = false; screenGui.Parent = game.CoreGui

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 420, 0, 650); mainFrame.Position = UDim2.new(0.5, -210, 0.5, -325)
mainFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 35); mainFrame.Active = true; mainFrame.Draggable = true; mainFrame.Parent = screenGui

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, 0, 0, 35); title.Text = "Gemini çµ‚æ¥µæ•´åˆ (Space+T ä¸Šå‡)"; title.TextColor3 = Color3.new(1, 1, 1); title.BackgroundColor3 = Color3.fromRGB(50, 50, 50); title.Parent = mainFrame

-- [é ‚éƒ¨åŠŸèƒ½æŒ‰éˆ•]
local toggleBtn = Instance.new("TextButton")
toggleBtn.Size = UDim2.new(0.43, 0, 0, 35); toggleBtn.Position = UDim2.new(0.05, 0, 0.07, 0)
toggleBtn.Text = "å¤œè¦–: é–‹å•Ÿ"; toggleBtn.BackgroundColor3 = Color3.fromRGB(0, 120, 0); toggleBtn.TextColor3 = Color3.new(1, 1, 1); toggleBtn.Parent = mainFrame

local clickerBtn = Instance.new("TextButton")
clickerBtn.Size = UDim2.new(0.43, 0, 0, 35); clickerBtn.Position = UDim2.new(0.52, 0, 0.07, 0)
clickerBtn.Text = "è‡ªå‹•é€£é»: é—œé–‰"; clickerBtn.BackgroundColor3 = Color3.fromRGB(120, 0, 0); clickerBtn.TextColor3 = Color3.new(1, 1, 1); clickerBtn.Parent = mainFrame

-- [æ•¸å€¼è¼¸å…¥å€ï¼šäº®åº¦ã€æ°´å¹³ã€ä¸Šå‡(é«˜åº¦é€Ÿåº¦)]
local function createInput(txt, pos, val)
    local lab = Instance.new("TextLabel")
    lab.Text = txt; lab.Size = UDim2.new(0, 40, 0, 25); lab.Position = pos; lab.TextColor3 = Color3.new(1, 1, 1); lab.BackgroundTransparency = 1; lab.Parent = mainFrame
    
    local box = Instance.new("TextBox")
    box.Size = UDim2.new(0, 50, 0, 25); box.Position = pos + UDim2.new(0, 40, 0, 0)
    box.BackgroundColor3 = Color3.fromRGB(60, 60, 60); box.TextColor3 = Color3.new(1, 1, 1); box.Text = tostring(val); box.Parent = mainFrame
    return box
end

local bBox = createInput("äº®åº¦", UDim2.new(0.05, 0, 0.15, 0), _G.BrightnessValue)
local sBox = createInput("æ°´å¹³", UDim2.new(0.35, 0, 0.15, 0), _G.MoveSpeed)
local uBox = createInput("ä¸Šå‡", UDim2.new(0.65, 0, 0.15, 0), _G.UpSpeed) -- é«˜åº¦é€Ÿåº¦èª¿æ•´æ¡†

-- [ç©å®¶åˆ—è¡¨èˆ‡å‚³é€åŠŸèƒ½]
local LeftScroll = Instance.new("ScrollingFrame")
LeftScroll.Size = UDim2.new(0, 185, 0, 150); LeftScroll.Position = UDim2.new(0.05, 0, 0.22, 0); LeftScroll.BackgroundColor3 = Color3.fromRGB(45, 45, 45); LeftScroll.Parent = mainFrame

local RightScroll = Instance.new("ScrollingFrame")
RightScroll.Size = UDim2.new(0, 185, 0, 150); RightScroll.Position = UDim2.new(0.52, 0, 0.22, 0); RightScroll.BackgroundColor3 = Color3.fromRGB(45, 45, 45); RightScroll.Parent = mainFrame

local TPBtn = Instance.new("TextButton")
TPBtn.Size = UDim2.new(0, 390, 0, 35); TPBtn.Position = UDim2.new(0.05, 0, 0.50, 0)
TPBtn.Text = "åŸ·è¡Œç©å®¶å‚³é€"; TPBtn.BackgroundColor3 = Color3.fromRGB(0, 80, 150); TPBtn.TextColor3 = Color3.new(1,1,1); TPBtn.Parent = mainFrame

-- [ç‰©å“åˆ—è¡¨å€]
local itemTitle = Instance.new("TextLabel")
itemTitle.Size = UDim2.new(0, 390, 0, 25); itemTitle.Position = UDim2.new(0.05, 0, 0.58, 0)
itemTitle.Text = "--- äº¤äº’ç‰©å“åˆ—è¡¨ (é»æ“Šå‚³é€) ---"; itemTitle.TextColor3 = Color3.new(0, 1, 0.5); itemTitle.BackgroundTransparency = 1; itemTitle.Parent = mainFrame

local ItemScroll = Instance.new("ScrollingFrame")
ItemScroll.Size = UDim2.new(0, 390, 0, 180); ItemScroll.Position = UDim2.new(0.05, 0, 0.63, 0)
ItemScroll.BackgroundColor3 = Color3.fromRGB(25, 25, 25); ItemScroll.Parent = mainFrame

local RefreshBtn = Instance.new("TextButton")
RefreshBtn.Size = UDim2.new(0, 390, 0, 40); RefreshBtn.Position = UDim2.new(0.05, 0, 0.92, 0)
RefreshBtn.Text = "ğŸ”„ åˆ·æ–°æ‰€æœ‰åˆ—è¡¨ (ç©å®¶+ç‰©å“)"; RefreshBtn.BackgroundColor3 = Color3.fromRGB(80, 80, 80); RefreshBtn.TextColor3 = Color3.new(1,1,1); RefreshBtn.Parent = mainFrame

------------------------------------------
-- 4. æ ¸å¿ƒé‚è¼¯
------------------------------------------

-- ç›£è½è¼¸å…¥æ¡†æ•¸å€¼
bBox.FocusLost:Connect(function() _G.BrightnessValue = tonumber(bBox.Text) or 0 end)
sBox.FocusLost:Connect(function() _G.MoveSpeed = tonumber(sBox.Text) or 1.7 end)
uBox.FocusLost:Connect(function() _G.UpSpeed = tonumber(uBox.Text) or 0.3 end)

-- åˆ·æ–°åˆ—è¡¨
local function updateLists()
    for _, v in pairs(LeftScroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    for _, v in pairs(RightScroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
    for _, v in pairs(ItemScroll:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end

    local playersArr = Players:GetPlayers()
    for i, p in pairs(playersArr) do
        local bL = Instance.new("TextButton"); bL.Size = UDim2.new(1,-10,0,30); bL.Position = UDim2.new(0,5,0,(i-1)*35); bL.Text = p.Name; bL.Parent = LeftScroll
        bL.BackgroundColor3 = (_G.SelectedSubject == p.Name) and Color3.fromRGB(0,100,200) or Color3.fromRGB(60,60,60)
        bL.MouseButton1Click:Connect(function() _G.SelectedSubject = p.Name; updateLists() end)
        
        local bR = Instance.new("TextButton"); bR.Size = UDim2.new(1,-10,0,30); bR.Position = UDim2.new(0,5,0,(i-1)*35); bR.Text = p.Name; bR.Parent = RightScroll
        bR.BackgroundColor3 = (_G.SelectedTarget == p.Name) and Color3.fromRGB(0,100,200) or Color3.fromRGB(60,60,60)
        bR.MouseButton1Click:Connect(function() _G.SelectedTarget = p.Name; updateLists() end)
    end
    LeftScroll.CanvasSize = UDim2.new(0,0,0,#playersArr*35); RightScroll.CanvasSize = UDim2.new(0,0,0,#playersArr*35)

    local itemIndex = 0
    for _, v in pairs(workspace:GetDescendants()) do
        if v:IsA("ProximityPrompt") or v:IsA("ClickDetector") or (v:IsA("TouchInterest") and v.Parent.Size.Magnitude < 10) then
            local obj = v.Parent
            if obj and (obj:IsA("BasePart") or obj:IsA("Model")) then
                local name = obj.Name
                if name == "Handle" or name == "Part" then name = obj.Parent.Name end
                local ibtn = Instance.new("TextButton")
                ibtn.Size = UDim2.new(1, -20, 0, 30); ibtn.Position = UDim2.new(0, 5, 0, itemIndex * 35); ibtn.Text = "ğŸ“ " .. name; ibtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50); ibtn.TextColor3 = Color3.new(1, 1, 1); ibtn.Parent = ItemScroll
                ibtn.MouseButton1Click:Connect(function()
                    if player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                        local cf = obj:IsA("Model") and obj:GetModelCFrame() or obj.CFrame
                        player.Character.HumanoidRootPart.CFrame = cf * CFrame.new(0, 3, 0)
                    end
                end)
                itemIndex = itemIndex + 1
            end
        end
    end
    ItemScroll.CanvasSize = UDim2.new(0, 0, 0, itemIndex * 35)
end

-- ç‰©ç†æ›´æ–°å¾ªç’°
RunService.Stepped:Connect(function()
    local hrp = player.Character and player.Character:FindFirstChild("HumanoidRootPart")
    local hum = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
    if hrp and hum then
        -- R éµæ°´å¹³ç§»å‹•
        if _G.IsPressingR and hum.MoveDirection.Magnitude > 0 then hrp.CFrame = hrp.CFrame + (hum.MoveDirection * _G.MoveSpeed) end
        -- ç©ºç™½éµæˆ– T éµä¸Šå‡ (å— _G.UpSpeed æ§åˆ¶)
        if _G.IsUpActive then 
            hrp.Velocity = Vector3.new(hrp.Velocity.X, 0, hrp.Velocity.Z)
            hrp.CFrame = hrp.CFrame * CFrame.new(0, _G.UpSpeed, 0) 
        end
    end
end)

-- å¤œè¦–æ¸²æŸ“
RunService.RenderStepped:Connect(function()
    if _G.NightVisionEnabled then
        Lighting.Ambient = Color3.new(1, 1, 1); Lighting.OutdoorAmbient = Color3.new(1, 1, 1)
        Lighting.ExposureCompensation = _G.BrightnessValue; Lighting.GlobalShadows = false
    end
end)

-- æŒ‰éˆ•ç¶å®š
toggleBtn.MouseButton1Click:Connect(function()
    _G.NightVisionEnabled = not _G.NightVisionEnabled
    toggleBtn.Text = _G.NightVisionEnabled and "å¤œè¦–: é–‹å•Ÿ" or "å¤œè¦–: é—œé–‰"
    toggleBtn.BackgroundColor3 = _G.NightVisionEnabled and Color3.fromRGB(0, 120, 0) or Color3.fromRGB(120, 0, 0)
end)

clickerBtn.MouseButton1Click:Connect(function()
    _G.AutoClicker = not _G.AutoClicker
    clickerBtn.Text = _G.AutoClicker and "è‡ªå‹•é€£é»: é–‹å•Ÿ" or "è‡ªå‹•é€£é»: é—œé–‰"
    clickerBtn.BackgroundColor3 = _G.AutoClicker and Color3.fromRGB(0, 120, 0) or Color3.fromRGB(120, 0, 0)
end)

RefreshBtn.MouseButton1Click:Connect(updateLists)
TPBtn.MouseButton1Click:Connect(function()
    local s = Players:FindFirstChild(_G.SelectedSubject); local t = Players:FindFirstChild(_G.SelectedTarget)
    if s and t and s.Character and t.Character then s.Character.HumanoidRootPart.CFrame = t.Character.HumanoidRootPart.CFrame end
end)

-- éµç›¤åµè½ (æ–°å¢ T éµ)
UserInputService.InputBegan:Connect(function(i, p)
    if not p then
        if i.KeyCode == Enum.KeyCode.R then 
            _G.IsPressingR = true 
        elseif i.KeyCode == Enum.KeyCode.Space or i.KeyCode == Enum.KeyCode.T then 
            _G.IsUpActive = true 
        end
    end
end)

UserInputService.InputEnded:Connect(function(i)
    if i.KeyCode == Enum.KeyCode.R then 
        _G.IsPressingR = false 
    elseif i.KeyCode == Enum.KeyCode.Space or i.KeyCode == Enum.KeyCode.T then 
        _G.IsUpActive = false 
    end
end)

-- è‡ªå‹•é€£é»
spawn(function()
    while true do
        if _G.AutoClicker then
            local vs = workspace.CurrentCamera.ViewportSize
            VirtualInputManager:SendMouseButtonEvent(vs.X/2, vs.Y/2, 0, true, game, 1)
            VirtualInputManager:SendMouseButtonEvent(vs.X/2, vs.Y/2, 0, false, game, 1)
        end
        task.wait(1)
    end
end)

updateLists()
