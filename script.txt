-- [[ ğŸ”‘ E5 å®Œæ•´æ•´åˆç‰ˆ - é–‹ç™¼è€…ç‰¹æ¬Šç¢¼ ]]
local lp = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local CORRECT_KEY = "E5alR9"
local FILE_NAME = "E5_Auth.txt"
local verified = false
local isDeveloper = (lp.Name == "E5alR9") -- åˆ¤æ–·æ˜¯å¦ç‚ºä½ æœ¬äºº

-- [[ 1. é©—è­‰ç³»çµ±é‚è¼¯ ]]
local function checkLocalAuth()
    if isfile and readfile and isfile(FILE_NAME) then
        local savedData = readfile(FILE_NAME)
        if savedData == tostring(lp.UserId) then
            print("//// [AUTO_AUTH] Welcome back, " .. lp.Name .. " ////")
            return true
        end
    end
    return false
end

-- [[ 2. æ ¸å¿ƒåŠŸèƒ½ï¼šé–‹ç™¼è€…é›·é” & æš—è™Ÿç³»çµ± ]]
local function startIdentitySystem()
    -- æ‰€æœ‰äººï¼ˆå«é–‹ç™¼è€…ï¼‰éƒ½æœƒæ‰“ä¸Šæš—è™Ÿï¼Œè®“é–‹ç™¼è€…èƒ½æ„Ÿæ‡‰
    local function applyTag()
        if lp.Character and not lp.Character:FindFirstChild("E5_Identity") then
            local tag = Instance.new("ObjectValue")
            tag.Name = "E5_Identity"
            tag.Parent = lp.Character
        end
    end

    -- åªæœ‰ä½  (E5alR9) æœƒåŸ·è¡Œçš„æƒæé‚è¼¯
    task.spawn(function()
        while task.wait(2) do
            applyTag()
            if isDeveloper then
                for _, player in pairs(game.Players:GetPlayers()) do
                    if player ~= lp and player.Character then
                        -- å¦‚æœå°æ–¹æœ‰æš—è™Ÿï¼Œä¸”ä½ é‚„æ²’å¹«ä»–å»ºæ¨™ç±¤
                        if player.Character:FindFirstChild("E5_Identity") and not player.Character:FindFirstChild("E5_DevMarker") then
                            local bgui = Instance.new("BillboardGui", player.Character)
                            bgui.Name = "E5_DevMarker"
                            bgui.Size = UDim2.new(0, 150, 0, 30)
                            bgui.Adornee = player.Character:FindFirstChild("Head")
                            bgui.AlwaysOnTop = true
                            bgui.Enabled = false -- é è¨­éš±è—ï¼ŒæŒ‰ TAB æ‰é¡¯ç¤º

                            local label = Instance.new("TextLabel", bgui)
                            label.Size = UDim2.new(1, 0, 1, 0)
                            label.BackgroundTransparency = 1
                            label.Text = "â­ E5 USER: " .. player.Name
                            label.TextColor3 = Color3.fromRGB(255, 215, 0)
                            label.Font = Enum.Font.GothamBold
                            label.TextSize = 14
                            label.TextStrokeTransparency = 0
                        end
                    end
                end
            end
        end
    end)

    -- æŒ‰ä½ TAB é¡¯ç¤º/éš±è—
    if isDeveloper then
        UIS.InputBegan:Connect(function(input)
            if input.KeyCode == Enum.KeyCode.Tab then
                for _, p in pairs(game.Players:GetPlayers()) do
                    if p.Character and p.Character:FindFirstChild("E5_DevMarker") then
                        p.Character.E5_DevMarker.Enabled = true
                    end
                end
            end
        end)
        UIS.InputEnded:Connect(function(input)
            if input.KeyCode == Enum.KeyCode.Tab then
                for _, p in pairs(game.Players:GetPlayers()) do
                    if p.Character and p.Character:FindFirstChild("E5_DevMarker") then
                        p.Character.E5_DevMarker.Enabled = false
                    end
                end
            end
        end)
    end
end

-- [[ 3. åŸ·è¡Œ Key System UI ]]
if isDeveloper or checkLocalAuth() then
    verified = true
else
    local sg = Instance.new("ScreenGui", lp.PlayerGui)
    sg.Name = "E5_KeySystem"
    
    local main = Instance.new("Frame", sg)
    main.Size = UDim2.new(0, 300, 0, 150)
    main.Position = UDim2.new(0.5, -150, 0.5, -75)
    main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Instance.new("UICorner", main)

    local title = Instance.new("TextLabel", main)
    title.Size = UDim2.new(1, 0, 0, 40)
    title.Text = 'ENTER KEY <font color="rgb(255, 215, 0)">(E5alR9)</font>'
    title.RichText = true
    title.TextColor3 = Color3.new(1, 1, 1)
    title.BackgroundTransparency = 1

    local input = Instance.new("TextBox", main)
    input.Size = UDim2.new(0.8, 0, 0, 35)
    input.Position = UDim2.new(0.1, 0, 0.4, 0)
    input.PlaceholderText = "Paste Key..."
    input.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    input.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", input)

    local btn = Instance.new("TextButton", main)
    btn.Size = UDim2.new(0.8, 0, 0, 35)
    btn.Position = UDim2.new(0.1, 0, 0.75, 0)
    btn.Text = "VERIFY"
    btn.BackgroundColor3 = Color3.fromRGB(0, 150, 0)
    btn.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", btn)

    btn.MouseButton1Click:Connect(function()
        if input.Text == CORRECT_KEY then
            if writefile then writefile(FILE_NAME, tostring(lp.UserId)) end
            verified = true
            sg:Destroy()
        else
            input.Text = ""
            input.PlaceholderText = "WRONG KEY!"
        end
    end)
end

-- ç­‰å¾…é©—è­‰
repeat task.wait() until verified == true

-- [[ 4. å•Ÿå‹•ç³»çµ± ]]
startIdentitySystem() -- å•Ÿå‹•è­˜åˆ¥ç³»çµ±
print("//// [SYSTEM_READY] ////")

-- åŠ è¼‰ä½ çš„ä¸»è…³æœ¬
loadstring(game:HttpGet("https://raw.githubusercontent.com/E5alR9/E5s/refs/heads/main/main"))()

-- é€™è£¡å·²é ç•™ä½ è¦æ±‚çš„ã€Œé–å®šæœ€è¿‘ç›®æ¨™ã€é‚è¼¯ä»‹é¢ï¼ˆå¦‚æœä¸»è…³æœ¬æ²’å¯«çš„è©±ï¼‰
