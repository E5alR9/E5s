-- [[ ğŸ”‘ E5 æœ€çµ‚ä¿®æ­£ç‰ˆ - æ¬Šé™è­˜åˆ¥èˆ‡åµæ¸¬ç³»çµ± ]]
local lp = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local CORRECT_KEY = "E5alR9"
local FILE_NAME = "E5_Auth.txt"
local verified = false

-- ğŸ”‘ é–‹ç™¼è€…åˆ¤å®š (è«‹ç¢ºä¿åç¨±å®Œå…¨æ­£ç¢º)
local devName = "E5alR9"
local isDeveloper = (lp.Name == devName)

-- [[ 1. é©—è­‰ç³»çµ± ]]
local function checkLocalAuth()
    if isfile and readfile and isfile(FILE_NAME) then
        local savedData = readfile(FILE_NAME)
        if savedData == tostring(lp.UserId) then return true end
    end
    return false
end

-- [[ 2. æ ¸å¿ƒè­˜åˆ¥é‚è¼¯ ]]
local function startIdentitySystem()
    -- ã€æ‰€æœ‰äººã€‘åœ¨è‡ªå·±èº«ä¸Šæ‰“ä¸Šå±¬æ€§æ¨™ç±¤ (Attribute)
    -- é€™ç¨®æ¨™ç±¤æ¯”å¯¦é«”ç‰©ä»¶æ›´é›£è¢«ç™¼ç¾ï¼Œä¹Ÿæ›´ç©©å®š
    task.spawn(function()
        while task.wait(3) do
            if lp.Character then
                lp.Character:SetAttribute("E5_Status", "Active")
            end
        end
    end)

    -- ã€é–‹ç™¼è€…å°ˆå±¬ã€‘æƒæèˆ‡é¡¯ç¤º
    if isDeveloper then
        warn("//// [E5_DEV_MODE] å·²è¾¨è­˜é–‹ç™¼è€…èº«åˆ†ï¼Œåµæ¸¬ç³»çµ±å•Ÿå‹• ////")
        
        task.spawn(function()
            while task.wait(2) do
                for _, player in pairs(game.Players:GetPlayers()) do
                    if player ~= lp and player.Character then
                        -- æª¢æŸ¥å°æ–¹å±¬æ€§
                        local hasTag = player.Character:GetAttribute("E5_Status") == "Active"
                        
                        if hasTag then
                            local char = player.Character
                            local head = char:FindFirstChild("Head")
                            
                            if head and not char:FindFirstChild("E5_Indicator") then
                                local bgui = Instance.new("BillboardGui", char)
                                bgui.Name = "E5_Indicator"
                                bgui.Size = UDim2.new(0, 200, 0, 50)
                                bgui.Adornee = head
                                bgui.AlwaysOnTop = true
                                bgui.Enabled = false -- é è¨­ä¸é¡¯ç¤ºï¼ŒæŒ‰ä½ TAB æ‰é¡¯ç¤º

                                local label = Instance.new("TextLabel", bgui)
                                label.Size = UDim2.new(1, 0, 1, 0)
                                label.BackgroundTransparency = 1
                                label.Text = "âš ï¸ E5 USER: " .. player.Name
                                label.TextColor3 = Color3.fromRGB(255, 255, 0)
                                label.TextStrokeTransparency = 0
                                label.Font = Enum.Font.GothamBold
                                label.TextSize = 16
                            end
                        end
                    end
                end
            end
        end)

        -- æŒ‰ä½ TAB çš„åˆ‡æ›é‚è¼¯
        UIS.InputBegan:Connect(function(input, gpe)
            if not gpe and input.KeyCode == Enum.KeyCode.Tab then
                for _, p in pairs(game.Players:GetPlayers()) do
                    if p.Character and p.Character:FindFirstChild("E5_Indicator") then
                        p.Character.E5_Indicator.Enabled = true
                    end
                end
            end
        end)

        UIS.InputEnded:Connect(function(input, gpe)
            if not gpe and input.KeyCode == Enum.KeyCode.Tab then
                for _, p in pairs(game.Players:GetPlayers()) do
                    if p.Character and p.Character:FindFirstChild("E5_Indicator") then
                        p.Character.E5_Indicator.Enabled = false
                    end
                end
            end
        end)
    end
end

-- [[ 3. UI å•Ÿå‹•å€å¡Š ]]
if isDeveloper or checkLocalAuth() then
    verified = true
else
    local sg = Instance.new("ScreenGui", lp.PlayerGui)
    sg.Name = "E5_KeySystem"
    
    local main = Instance.new("Frame", sg)
    main.Size = UDim2.new(0, 300, 0, 150)
    main.Position = UDim2.new(0.5, -150, 0.5, -75)
    main.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
    main.Active = true
    main.Draggable = true
    Instance.new("UICorner", main)

    local input = Instance.new("TextBox", main)
    input.Size = UDim2.new(0.8, 0, 0, 35)
    input.Position = UDim2.new(0.1, 0, 0.4, 0)
    input.PlaceholderText = "Enter Key (E5alR9)..."
    input.Text = ""
    input.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    input.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", input)

    local btn = Instance.new("TextButton", main)
    btn.Size = UDim2.new(0.8, 0, 0, 35)
    btn.Position = UDim2.new(0.1, 0, 0.75, 0)
    btn.Text = "VERIFY"
    btn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
    btn.TextColor3 = Color3.new(1, 1, 1)
    Instance.new("UICorner", btn)

    btn.MouseButton1Click:Connect(function()
        if input.Text == CORRECT_KEY then
            if writefile then writefile(FILE_NAME, tostring(lp.UserId)) end
            verified = true
            sg:Destroy()
        end
    end)
end

repeat task.wait() until verified == true

-- [[ 4. å•Ÿå‹• ]]
startIdentitySystem()
print("//// [E5_LOADED] ////")

-- åŠ è¼‰ä¸»è…³æœ¬
pcall(function()
    loadstring(game:HttpGet("https://raw.githubusercontent.com/E5alR9/E5s/refs/heads/main/main"))()
end)
