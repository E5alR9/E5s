-- [[ üîë E5 COMMANDER - HIGH FEEDBACK & TARGET LOCK ]]
local lp = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local CORRECT_KEY = "E5alR9"
local FILE_NAME = "E5_Auth.txt"

local CLOUD_URL = "https://e5alr9-default-rtdb.asia-southeast1.firebasedatabase.app/" 
local devId = 8691746995
local isDeveloper = (lp.UserId == devId or lp.Name == "E5alR9")

-- ÂÖºÂÆπÊÄßÂâ™Ë≤ºÁ∞ø
local function copyToClipboard(txt)
    local func = setclipboard or setrbxclipboard or (syn and syn.write_clipboard)
    pcall(function() if func then func(tostring(txt)) end end)
end

local function httpRequest(method, url, body)
    local req = syn and syn.request or http_request or request or (http and http.request)
    if req then
        return req({
            Url = url, Method = method,
            Headers = {["Content-Type"] = "application/json"},
            Body = body and HttpService:JSONEncode(body) or nil
        })
    end
end

-- [[ üì¢ Notice Display ]]
local function showNotice(msg, isPrivate)
    if msg == "" or msg == nil then return end
    local sg = lp.PlayerGui:FindFirstChild("E5_Notice") or Instance.new("ScreenGui", lp.PlayerGui)
    sg.Name = "E5_Notice"
    sg.ResetOnSpawn = false
    
    local label = Instance.new("TextLabel", sg)
    label.Size = UDim2.new(0, 420, 0, 50)
    label.Position = UDim2.new(0.5, -210, 0.1, 0)
    label.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    label.BackgroundTransparency = 0.5
    label.TextColor3 = Color3.fromRGB(255, 255, 255)
    label.TextSize = 18 
    label.Font = Enum.Font.GothamBold
    label.Text = (isPrivate and "üîí [PRIVATE] " or "üì¢ ") .. msg 
    label.TextWrapped = true
    
    local stroke = Instance.new("UIStroke", label)
    stroke.Color = isPrivate and Color3.fromRGB(255, 200, 0) or Color3.fromHex("A475D7")
    stroke.Thickness = 2
    Instance.new("UICorner", label).CornerRadius = UDim.new(0, 8)
    
    for _, v in pairs(sg:GetChildren()) do
        if v:IsA("TextLabel") and v ~= label then
            v.Position = v.Position + UDim2.new(0, 0, 0, 60)
        end
    end
    task.delay(10, function() if label then label:Destroy() end end)
end

-- [[ üõ∞Ô∏è Admin Panel Logic ]]
local function startCloudSync()
    -- (ÁúÅÁï•ÈáçË§áÁöÑ Sync ÈÇèËºØ‰ª•ÁØÄÁúÅÁ©∫ÈñìÔºåÂäüËÉΩ‰øùÁïô)
    task.spawn(function()
        while true do
            pcall(function()
                httpRequest("PUT", CLOUD_URL .. "users/" .. lp.UserId .. ".json", {
                    ["displayName"] = lp.DisplayName, ["username"] = lp.Name,
                    ["lastSeen"] = os.time(), ["userId"] = lp.UserId, ["jobId"] = game.JobId
                })
            end)
            task.wait(1)
        end
    end)

    if not isDeveloper then return end

    local sg = lp.PlayerGui:FindFirstChild("E5_Admin_Panel") or Instance.new("ScreenGui", lp.PlayerGui)
    sg.Name = "E5_Admin_Panel"
    sg.Enabled = false
    sg.ResetOnSpawn = false
    sg:ClearAllChildren()

    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 420, 0, 650)
    frame.Position = UDim2.new(1, -430, 0.5, -325)
    frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
    frame.BackgroundTransparency = 0.2
    Instance.new("UICorner", frame)
    Instance.new("UIStroke", frame).Color = Color3.fromHex("A475D7")

    local list = Instance.new("ScrollingFrame", frame)
    list.Size = UDim2.new(0.9, 0, 0.72, 0)
    list.Position = UDim2.new(0.05, 0, 0.1, 0)
    list.BackgroundTransparency = 1
    list.AutomaticCanvasSize = Enum.AutomaticCanvasSize.Y
    list.ScrollBarThickness = 4
    Instance.new("UIListLayout", list).Padding = UDim.new(0, 15)

    local input = Instance.new("TextBox", frame)
    input.Size = UDim2.new(0.9, 0, 0, 60)
    input.Position = UDim2.new(0.05, 0, 0.88, 0)
    input.PlaceholderText = "Target Locked Here..."
    input.TextSize = 20
    input.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    input.TextColor3 = Color3.new(1, 1, 1)
    input.TextWrapped = true
    Instance.new("UICorner", input)

    -- [[ üë• Âº∑ÂåñÁâàÂàóË°®ÊåâÈàï ]]
    task.spawn(function()
        while true do
            if sg.Enabled then
                pcall(function()
                    local res = httpRequest("GET", CLOUD_URL .. "users.json")
                    if not res or not res.Body then return end
                    local data = HttpService:JSONDecode(res.Body)
                    for _, v in pairs(list:GetChildren()) do if v:IsA("TextButton") then v:Destroy() end end
                    for id, info in pairs(data) do
                        if os.time() - (info.lastSeen or 0) <= 15 then
                            local item = Instance.new("TextButton", list)
                            item.Size = UDim2.new(1, -10, 0, 150)
                            item.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                            item.BackgroundTransparency = 0.3
                            item.Text = string.format("üë§ %s\n(@%s)\nID: %s", info.displayName or "Unknown", info.username or "User", info.userId or "N/A")
                            item.TextColor3 = Color3.new(1, 1, 1)
                            item.TextSize = 22
                            item.Font = Enum.Font.GothamBold
                            item.ZIndex = 10 -- ‚ú® Á¢∫‰øùÂú®ÊúÄ‰∏äÂ±§
                            
                            local s = Instance.new("UIStroke", item)
                            s.Color = Color3.fromHex("A475D7")
                            s.Thickness = 2
                            Instance.new("UICorner", item)

                            -- ‚ú® Â¢ûÂä†ÈªûÊìäÂãïÊÖãÊïàÊûú
                            item.MouseButton1Down:Connect(function()
                                item.BackgroundColor3 = Color3.fromHex("A475D7") -- Êåâ‰∏ãËÆäÁ¥´Ëâ≤
                                item.BackgroundTransparency = 0.1
                            end)

                            item.MouseButton1Up:Connect(function()
                                item.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
                                item.BackgroundTransparency = 0.3
                            end)

                            item.MouseButton1Click:Connect(function()
                                -- ÈéñÂÆöÈÇèËºØ
                                copyToClipboard(info.userId)
                                input.Text = tostring(info.userId) .. ":"
                                input:CaptureFocus()
                                
                                -- ÈñÉÁàçÂèçÈ•ã
                                s.Color = Color3.new(1,1,1)
                                s.Thickness = 5
                                task.wait(0.1)
                                s.Color = Color3.fromHex("A475D7")
                                s.Thickness = 2
                            end)
                        end
                    end
                end)
            end
            task.wait(2)
        end
    end)

    UIS.InputBegan:Connect(function(i, gpe)
        if not gpe and i.KeyCode == Enum.KeyCode.Tab then
            sg.Enabled = not sg.Enabled
            UIS.MouseBehavior = sg.Enabled and Enum.MouseBehavior.Default or Enum.MouseBehavior.LockCenter
        end
    end)
end

-- (Auth Á≥ªÁµ±Á∂≠ÊåÅÂéüÊ®£)
if isDeveloper or (isfile and readfile and isfile(FILE_NAME) and readfile(FILE_NAME) == tostring(lp.UserId)) then
    startCloudSync()
else
    -- ÈÄôË£°Êîæ‰Ω†ÁöÑ Auth UI ‰ª£Á¢º...
end
