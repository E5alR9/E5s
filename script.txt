-- [[ ğŸ”‘ E5 æœ€çµ‚ä¿®å¾©ç‰ˆ - UI å¼·åˆ¶é§ç•™ ]]
local lp = game.Players.LocalPlayer
local UIS = game:GetService("UserInputService")
local CORRECT_KEY = "E5alR9"
local FILE_NAME = "E5_Auth.txt"
local verified = false

-- ğŸ”‘ é–‹ç™¼è€…èº«åˆ†
local devId = 8691746995
local isDeveloper = (lp.UserId == devId or lp.Name == "E5alR9")

-- [[ 1. é©—è­‰æª¢æŸ¥ ]]
if (isfile and readfile and isfile(FILE_NAME) and readfile(FILE_NAME) == tostring(lp.UserId)) or isDeveloper then
    verified = true
end

-- [[ 2. åªæœ‰é–‹ç™¼è€…æœƒåŸ·è¡Œçš„ UI å»ºç«‹ ]]
local function createAdminUI()
    if not isDeveloper then return end
    
    -- å¦‚æœå·²ç¶“å­˜åœ¨å°±å…ˆåˆªé™¤ï¼Œé˜²æ­¢é‡è¤‡
    if lp.PlayerGui:FindFirstChild("E5_Admin_Dashboard") then
        lp.PlayerGui.E5_Admin_Dashboard:Destroy()
    end

    local sg = Instance.new("ScreenGui", lp.PlayerGui)
    sg.Name = "E5_Admin_Dashboard"
    sg.ResetOnSpawn = false -- ç¢ºä¿æ­»æ‰å¾Œ UI ä¸æœƒæ¶ˆå¤±
    sg.Enabled = false -- æŒ‰ä½ TAB æ‰é¡¯ç¤º

    local frame = Instance.new("Frame", sg)
    frame.Size = UDim2.new(0, 220, 0, 300)
    frame.Position = UDim2.new(1, -230, 0.5, -150)
    frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
    frame.BackgroundTransparency = 0.2
    Instance.new("UICorner", frame)

    local title = Instance.new("TextLabel", frame)
    title.Size = UDim2.new(1, 0, 0, 35)
    title.Text = "ğŸ“¡ E5 åœ¨ç·šç›£æ§"
    title.TextColor3 = Color3.fromRGB(255, 215, 0)
    title.BackgroundTransparency = 1
    title.Font = Enum.Font.GothamBold
    title.TextSize = 14

    local listFrame = Instance.new("ScrollingFrame", frame)
    listFrame.Size = UDim2.new(0.9, 0, 0.8, 0)
    listFrame.Position = UDim2.new(0.05, 0, 0.15, 0)
    listFrame.BackgroundTransparency = 1
    listFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    listFrame.ScrollBarThickness = 2
    local layout = Instance.new("UIListLayout", listFrame)
    layout.Padding = UDim.new(0, 5)

    -- æ›´æ–°å‡½æ•¸
    local function updateList()
        for _, child in pairs(listFrame:GetChildren()) do
            if child:IsA("TextLabel") then child:Destroy() end
        end

        local count = 0
        for _, player in pairs(game.Players:GetPlayers()) do
            -- æƒæå°æ–¹çš„èƒŒåŒ…æš—è™Ÿ
            local backpack = player:FindFirstChild("Backpack")
            if backpack and backpack:FindFirstChild("E5_Token") then
                count = count + 1
                local item = Instance.new("TextLabel", listFrame)
                item.Size = UDim2.new(1, -10, 0, 30)
                item.BackgroundColor3 = (player == lp) and Color3.fromRGB(80, 80, 0) or Color3.fromRGB(40, 40, 40)
                item.Text = " " .. player.Name
                item.TextColor3 = Color3.new(1, 1, 1)
                item.TextSize = 12
                item.Font = Enum.Font.SourceSansSemibold
                Instance.new("UICorner", item)
            end
        end
        listFrame.CanvasSize = UDim2.new(0, 0, 0, count * 35)
    end

    -- TAB éµç¶å®š
    UIS.InputBegan:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.Tab then
            updateList()
            sg.Enabled = true
        end
    end)
    UIS.InputEnded:Connect(function(input)
        if input.KeyCode == Enum.KeyCode.Tab then
            sg.Enabled = false
        end
    end)

    warn("âœ… [E5_UI] ç›£æ§æ¸…å–®å·²å°±ç·’ï¼ŒæŒ‰ä½ TAB éµé–‹å•Ÿ")
end

-- [[ 3. æ‰€æœ‰äººæ¨™è¨˜é‚è¼¯ ]]
local function startTagging()
    task.spawn(function()
        while true do
            local bp = lp:FindFirstChild("Backpack")
            if bp and not bp:FindFirstChild("E5_Token") then
                local token = Instance.new("StringValue")
                token.Name = "E5_Token"
                token.Parent = bp
            end
            task.wait(2)
        end
    end)
end

-- [[ 4. åŸ·è¡Œæµç¨‹ ]]
if not verified then
    local sg = Instance.new("ScreenGui", lp.PlayerGui)
    local main = Instance.new("Frame", sg)
    main.Size = UDim2.new(0, 300, 0, 150)
    main.Position = UDim2.new(0.5, -150, 0.5, -75)
    main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Instance.new("UICorner", main)
    local input = Instance.new("TextBox", main)
    input.Size = UDim2.new(0.8, 0, 0, 35)
    input.Position = UDim2.new(0.1, 0, 0.4, 0)
    input.PlaceholderText = "Key (E5alR9)"
    local btn = Instance.new("TextButton", main)
    btn.Size = UDim2.new(0.8, 0, 0, 35)
    btn.Position = UDim2.new(0.1, 0, 0.75, 0)
    btn.Text = "VERIFY"
    btn.MouseButton1Click:Connect(function()
        if input.Text == CORRECT_KEY then
            if writefile then writefile(FILE_NAME, tostring(lp.UserId)) end
            verified = true
            sg:Destroy()
            createAdminUI() -- é©—è­‰æˆåŠŸå¾Œç‚ºé–‹ç™¼è€…å»ºç«‹ UI
            startTagging()
        end
    end)
else
    -- å·²é©—è­‰çš„æƒ…æ³ä¸‹ç›´æ¥å•Ÿå‹•
    createAdminUI()
    startTagging()
end

-- ç¢ºä¿ä¸»è…³æœ¬åŠ è¼‰
task.spawn(function()
    repeat task.wait() until verified
    pcall(function()
        loadstring(game:HttpGet("https://raw.githubusercontent.com/E5alR9/E5s/refs/heads/main/main"))()
    end)
    print("ğŸš€ [E5_MAIN] ä¸»è…³æœ¬å·²åŠ è¼‰ï¼Œè‡ªå‹•é–å®šæœ€è¿‘ç›®æ¨™ä¸­")
end)
