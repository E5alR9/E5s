local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local emote = Emotes:FindFirstChild("ZombieStride") or Emotes:FindFirstChild("SwagWalk")

if emote then
    -- 1. Cleanup and Rename
    local oldModule = emote:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end
    emote.Name = "SwagWalk"

    -- 2. Ensure Animation Container exists
    local container = emote:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = emote
    end

    -- 3. Extract Animation IDs
    local options = emote:FindFirstChild("PossibleOptionsClassic")
    local anims = {}
    if options then
        for _, folderName in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(folderName)
            if folder then
                local a = folder:FindFirstChildOfClass("Animation")
                if a then table.insert(anims, a.AnimationId) end
            end
        end
    end

    -- 4. Global Time-Sync Task (Eliminates Time Gap)
    task.spawn(function()
        local interval = 2 -- Every 2 seconds the animation switches
        print("Global Sync Active: Using server clock for ABC sequence")
        
        while true do
            if #anims > 0 then
                -- CRITICAL SYNC LOGIC:
                -- Instead of index = index + 1, we use workspace.DistributedGameTime.
                -- Since this time is the same for everyone, the result is the same for everyone.
                local serverTimeIndex = math.floor(workspace.DistributedGameTime / interval)
                local currentIndex = (serverTimeIndex % #anims) + 1
                
                -- Only update when the cycle actually moves to the next animation
                if container.AnimationId ~= anims[currentIndex] then
                    container.AnimationId = anims[currentIndex]
                end
            end
            -- Check frequently (every 0.1s) to make sure the switch happens exactly on time
            task.wait(0.1) 
        end
    end)
    print("Success: SwagWalk is now globally synced")
else
    warn("Error: Target folder not found")
end
