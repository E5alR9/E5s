local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local emote = Emotes:FindFirstChild("ZombieStride") or Emotes:FindFirstChild("SwagWalk")

if emote then
    -- 1. Cleanup and Rename
    local oldModule = emote:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end
    emote.Name = "SwagWalk"

    -- 2. Setup Animation Container
    local container = emote:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = emote
    end

    -- 3. Extract IDs from A, B, and C
    local options = emote:FindFirstChild("PossibleOptionsClassic")
    local anims = {}
    if options then
        for _, folderName in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(folderName)
            if folder then
                local a = folder:FindFirstChildOfClass("Animation")
                if a then table.insert(anims, a.AnimationId) end
            end
        end
    end

    -- 4. Precise Time-Alignment Loop
    task.spawn(function()
        local cycleLength = 6 -- 假設 A,B,C 總共循環一次需要 6 秒 (各2秒)
        local syncBase = 10   -- 每 10 秒強制對齊一次基準點
        print("Precise Sync Started: Aligning to multiples of " .. tostring(syncBase))
        
        while true do
            if #anims > 0 then
                -- 核心邏輯：計算從遊戲開始到現在過了多少秒
                local totalTime = workspace.DistributedGameTime
                
                -- 使用模運算確保所有人計算出的「當前應該播放哪一個」完全一致
                -- 每 2 秒換一個動作
                local interval = 2
                local index = (math.floor(totalTime / interval) % #anims) + 1
                
                -- 更新 ID
                if container.AnimationId ~= anims[index] then
                    container.AnimationId = anims[index]
                end
            end
            -- 頻繁檢查 (每 0.1 秒) 確保切換瞬間是同步的
            task.wait(0.1)
        end
    end)
    print("Success: SwagWalk is now strictly synced to game clock")
else
    warn("Error: Target folder not found")
end
