local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local original = Emotes:FindFirstChild("ZombieStride")

if original then
    -- 1. 複製出一個全新的資料夾，並命名為 SwagWalk
    local swag = Emotes:FindFirstChild("SwagWalk")
    if swag then swag:Destroy() end -- 如果已經有了就先刪除，確保更新到最新版
    
    swag = original:Clone()
    swag.Name = "SwagWalk"
    swag.Parent = Emotes
    print("Folder copied: SwagWalk created from ZombieStride")

    -- 2. 對 SwagWalk 進行操作 (不影響原本的 ZombieStride)
    local oldModule = swag:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end

    -- 3. 確保播放容器存在
    local container = swag:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = swag
    end

    -- 4. 抓取 A, B, C 的 ID
    local options = swag:FindFirstChild("PossibleOptionsClassic")
    local anims = {}
    if options then
        for _, folderName in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(folderName)
            if folder then
                local a = folder:FindFirstChildOfClass("Animation")
                if a then table.insert(anims, a.AnimationId) end
            end
        end
    end

    -- 5. 高精度全域同步循環 (所有人抓到的變數完全相同)
    task.spawn(function()
        local interval = 2 -- 每 2 秒換一個動作
        print("High-Precision Sync: SwagWalk is now locking to server clock")
        
        while true do
            if #anims > 0 then
                -- 使用 GetServerTimeNow 確保所有人拿到的時間數值毫秒級同步
                local totalTime = workspace:GetServerTimeNow()
                local index = (math.floor(totalTime / interval) % #anims) + 1
                
                -- 更新 SwagWalk 裡的 ID
                if container.AnimationId ~= anims[index] then
                    container.AnimationId = anims[index]
                end
            end
            task.wait(0.1) -- 保持高頻檢查
        end
    end)
    print("Success: Both folders exist. SwagWalk is running ABC sync.")
else
    warn("Error: Original ZombieStride not found.")
end
