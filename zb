local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local Swag = Emotes:FindFirstChild("SwagWalk") or Emotes:FindFirstChild("ZombieStride")

if Swag then
    -- 1. 基本物理操作 (更名、刪除模組)
    local oldModule = Swag:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end
    Swag.Name = "SwagWalk"

    -- 2. 準備動畫容器
    local container = Swag:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = Swag
    end

    -- 3. 讀取 A, B, C IDs
    local anims = {}
    local options = Swag:FindFirstChild("PossibleOptionsClassic")
    if options then
        for _, name in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(name)
            local anim = folder and f:FindFirstChildOfClass("Animation")
            if anim then table.insert(anims, anim.AnimationId) end
        end
    end

    -- 4. 溫和同步邏輯 (不干擾原本修改)
    task.spawn(function()
        local interval = 2 -- 每 2 秒換一個動作
        print("Gentle Sync Started: Aligning with server time...")

        while true do
            if #anims > 0 then
                -- 核心：根據全服時間計算當前 index
                local serverTime = workspace.DistributedGameTime
                local index = (math.floor(serverTime / interval) % #anims) + 1
                
                -- 【關鍵修正】：只有當 ID 真的不一致時，才進行一次性修改
                -- 這樣平時就不會一直寫入屬性，不會導致動畫卡死
                if container.AnimationId ~= anims[index] then
                    container.AnimationId = anims[index]
                    print("Sync: Switched to animation index " .. tostring(index))
                end
            end
            -- 每 0.5 秒檢查一次即可，不需要太快，防止系統過熱
            task.wait(0.5)
        end
    end)
    print("Success: SwagWalk sync is ready and gentle.")
else
    warn("Error: Target folder not found.")
end
