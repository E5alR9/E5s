local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local Swag = Emotes:FindFirstChild("SwagWalk") or Emotes:FindFirstChild("ZombieStride")

if Swag then
    -- 1. Setup structure and rename
    local oldModule = Swag:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end
    Swag.Name = "SwagWalk"

    local container = Swag:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = Swag
    end

    -- 2. Collect IDs for A, B, and C
    local anims = {}
    local options = Swag:FindFirstChild("PossibleOptionsClassic")
    if options then
        for _, name in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(name)
            local anim = folder and folder:FindFirstChildOfClass("Animation")
            if anim then table.insert(anims, anim.AnimationId) end
        end
    end

    -- 3. Universal Time-based Switching
    task.spawn(function()
        local switchInterval = 2 -- Every 2 seconds change to next animation
        print("ABC Universal Sync: Online")

        while true do
            if #anims > 0 then
                -- CRITICAL: Uses absolute game time to determine the index
                -- Everyone on the server calculates the same index at the same micro-second
                local timeNow = workspace.DistributedGameTime
                local index = (math.floor(timeNow / switchInterval) % #anims) + 1
                
                -- Only update if the ID is different to avoid flickering
                if container.AnimationId ~= anims[index] then
                    container.AnimationId = anims[index]
                end
            end
            task.wait(0.1) -- High-frequency check for perfect alignment
        end
    end)
    print("Success: ABC Sync is now locked to server clock.")
else
    warn("Error: Folder not found.")
end
