local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local original = Emotes:FindFirstChild("ZombieStride")

if original then
    -- 1. 複製原始資料夾為 SwagWalk，確保原始資料夾 (ZombieStride) 完好不動
    local emote = Emotes:FindFirstChild("SwagWalk")
    if emote then emote:Destroy() end -- 重啟時更新複製本
    
    emote = original:Clone()
    emote.Name = "SwagWalk"
    emote.Parent = Emotes
    print("Success: SwagWalk created as a copy of ZombieStride")

    -- 2. 移除新資料夾內的模組 (對原始資料夾無影響)
    local oldModule = emote:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end

    -- 3. 設定播放容器
    local container = emote:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = emote
    end

    -- 4. 提取 A, B, C 的動畫 ID
    local options = emote:FindFirstChild("PossibleOptionsClassic")
    local anims = {}
    if options then
        for _, folderName in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(folderName)
            if folder then
                local a = folder:FindFirstChildOfClass("Animation")
                if a then table.insert(anims, a.AnimationId) end
            end
        end
    end

    -- 5. 高精度同步循環 (任何人、任何時間抓到的結果都一致)
    task.spawn(function()
        local interval = 2 -- 每 2 秒換一個動作
        print("High-Precision Sync: Locking ABC to Global Server Time")
        
        while true do
            if #anims > 0 then
                -- 使用 Roblox 官方最高精度同步時間：GetServerTimeNow()
                -- 這確保了所有玩家在「同一毫秒」計算出的 index 都是相同的
                local totalTime = workspace:GetServerTimeNow()
                local index = (math.floor(totalTime / interval) % #anims) + 1
                
                -- 更新 SwagWalk 裡的 AnimationId 屬性
                if container.AnimationId ~= anims[index] then
                    container.AnimationId = anims[index]
                    -- print("Synced to Animation ID Index: " .. tostring(index))
                end
            end
            -- 0.1 秒檢查一次，極速同步，不產生時間差
            task.wait(0.1)
        end
    end)
    print("ABC Synchronization is now active on SwagWalk.")
else
    warn("Error: Original 'ZombieStride' folder not found. Please check your ReplicatedStorage.")
end
