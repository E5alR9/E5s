local Emotes = game:GetService("ReplicatedStorage").Items.Emotes
local emote = Emotes:FindFirstChild("ZombieStride") or Emotes:FindFirstChild("SwagWalk")

if emote then
    -- 1. Cleanup and Rename
    local oldModule = emote:FindFirstChild("EmoteModuleClassic")
    if oldModule then oldModule:Destroy() end
    emote.Name = "SwagWalk"

    -- 2. Setup Animation Container
    local container = emote:FindFirstChild("AnimationClassic")
    if not container then
        container = Instance.new("Animation")
        container.Name = "AnimationClassic"
        container.Parent = emote
    end

    -- 3. Extract IDs from A, B, and C
    local options = emote:FindFirstChild("PossibleOptionsClassic")
    local anims = {}
    if options then
        for _, folderName in ipairs({"A", "B", "C"}) do
            local folder = options:FindFirstChild(folderName)
            if folder then
                local a = folder:FindFirstChildOfClass("Animation")
                if a then table.insert(anims, a.AnimationId) end
            end
        end
    end

    -- 4. High-Precision Server Clock Sync
    task.spawn(function()
        local interval = 2 -- 每 2 秒換一個動作
        print("High-Precision Sync: Locking to ServerTimeNow")
        
        while true do
            if #anims > 0 then
                -- 核心：GetServerTimeNow() 會回傳伺服器的絕對秒數（包含小數點）
                -- 這在所有玩家的電腦上都會自動校準，達到真正的同步
                local serverTime = workspace:GetServerTimeNow()
                local index = (math.floor(serverTime / interval) % #anims) + 1
                
                -- 只有在真正需要切換時才改動屬性
                if container.AnimationId ~= anims[index] then
                    container.AnimationId = anims[index]
                    -- print("Synced Switch to Index: " .. tostring(index))
                end
            end
            -- 每 0.1 秒檢查一次，確保切換點極度精準
            task.wait(0.1)
        end
    end)
    print("Success: ABC cycle is now perfectly synced across all clients.")
else
    warn("Error: Target folder not found")
end
