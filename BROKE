-- [[ 全域變數初始化 ]]
_G.bhop = false

local p = game:GetService("Players").LocalPlayer
local RS = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

-- 取得官方跳躍按鈕
local function getJumpButton()
    local touchGui = p:FindFirstChild("PlayerGui") and p.PlayerGui:FindFirstChild("TouchGui")
    return touchGui and touchGui:FindFirstChild("JumpButton", true)
end

-- [[ 核心循環 ]]
RS.Heartbeat:Connect(function()
    local c = p.Character
    local hum = c and c:FindFirstChildOfClass("Humanoid")
    local jumpBtn = getJumpButton()

    if hum and jumpBtn then
        -- 核心判定：
        -- 1. 監測 Humanoid.Jump (當你按住官方鈕時，這會反覆閃爍)
        -- 2. 監測按鈕透明度 (官方按鈕按下時會變深/變淺，通常從 0.5 變動)
        if hum.Jump or jumpBtn.ImageTransparency ~= 0.5 then
            _G.bhop = true
        else
            _G.bhop = false
        end

        -- 執行連跳
        if _G.bhop then
            -- 撞牆或在地板都強制起跳
            local state = hum:GetState()
            if hum.FloorMaterial ~= Enum.Material.Air or state == Enum.HumanoidStateType.Freefall or state == Enum.HumanoidStateType.Landed then
                hum:ChangeState(3)
            end
        end
    end
end)
