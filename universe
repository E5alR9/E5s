-- [[ ğŸŒŒ å¤©æ–‡å…‰è­œ 113.0 - 15,000 çƒ / æŒ‰å¤§å°åˆ†ä½ˆçœŸå¯¦è‰² / 100 FPS å¹³è¡¡ / Tab ç¸®é€² ]]
local Lighting = game:GetService("Lighting")
local RunService = game:GetService("RunService")
local p = game:GetService("Players").LocalPlayer
local v113Tag = "Universe_Spectra_V113"

-- ã€1. ç’°å¢ƒå‚™ä»½èˆ‡æ¢å¾©ã€‘
local existing = workspace:FindFirstChild(v113Tag)
if existing then
	_G.v113Active = false; existing:Destroy()
	if _G.EnvBackupV113 then
		Lighting.ClockTime, Lighting.Brightness, Lighting.OutdoorAmbient = _G.EnvBackupV113.T, _G.EnvBackupV113.B, _G.EnvBackupV113.O
	end
	return 
end

_G.EnvBackupV113 = {T = Lighting.ClockTime, B = Lighting.Brightness, O = Lighting.OutdoorAmbient}
_G.v113Active = true
local currentSession = tick()
_G.v113Session = currentSession

Lighting.ClockTime, Lighting.Brightness, Lighting.OutdoorAmbient = 0, 0, Color3.new(0,0,0)
local container = Instance.new("Model", workspace)
container.Name = v113Tag

-- ã€2. æ ¸å¿ƒè®Šé‡ã€‘
local stars = {}
local targetTotalStars = 15000 
local currentTotalCount = 0
local fps = 144

-- ã€3. çœŸå¯¦å…‰è­œè‰²å½©å‡½æ•¸ã€‘
local function getStarSpecs()
	local rand = math.random()
	local size, color
	if rand > 0.95 then -- å¤§è³ªé‡è—/ç™½æ˜Ÿ (æ¥µå°‘æ•¸)
		size = 4.5 + math.random() * 3.5
		color = Color3.fromRGB(180, 220, 255) -- è—ç™½è‰²
	elseif rand > 0.70 then -- ä¸­ç­‰é»ƒ/ç™½æ˜Ÿ (å¤ªé™½é¡)
		size = 2.5 + math.random() * 2
		color = Color3.fromRGB(255, 255, 230) -- æ·¡é»ƒç™½
	else -- å°è³ªé‡æ©™/ç´…æ˜Ÿ (å¤šæ•¸)
		size = 1.2 + math.random() * 1.5
		color = Color3.fromRGB(255, 120, 60) -- æ©™ç´…è‰²
	end
	return size, color
end

-- ã€4. æ˜Ÿçƒç”Ÿæˆï¼š500-1200 ç¢¼ã€‘
local function createStar()
	local radius = math.random(500, 1200)
	local phi = math.rad(math.random(360))
	local theta = math.acos(2 * math.random() - 1)
	
	local size, color = getStarSpecs()
	
	local s = Instance.new("Part", container)
	s.Shape, s.Anchored, s.CanCollide, s.Material = Enum.PartType.Ball, true, false, Enum.Material.Neon
	s.Size = Vector3.new(size, size, size)
	s.Color = color
	
	local starData = {
		Obj = s, Radius = radius, Phi = phi, Theta = theta,
		Speed = (math.random() > 0.5 and 1 or -1) * (math.random(30, 75) * 0.00001)
	}
	currentTotalCount = currentTotalCount + 1
	return starData
end

-- ã€5. æ ¸å¿ƒå¾ªç’°ã€‘
task.spawn(function()
	-- åˆå§‹å•Ÿå‹•
	for i = 1, 1500 do table.insert(stars, createStar()) end

	while _G.v113Active and _G.v113Session == currentSession do
		local dt = RunService.RenderStepped:Wait()
		fps = 0.9 * fps + 0.1 * (1 / dt)
		local char = p.Character and p.Character:FindFirstChild("HumanoidRootPart")
		if not char then continue end
		local rp = char.Position

		-- ã€100 FPS å®ˆè­·è€…ã€‘
		if fps < 100 and #stars > 100 then
			for k = 1, 35 do
				local s = table.remove(stars, math.random(#stars))
				if s then s.Obj:Destroy() end
				currentTotalCount = currentTotalCount - 1
			end
		elseif fps > 105 and currentTotalCount < targetTotalStars then
			for k = 1, 25 do
				if currentTotalCount < targetTotalStars then
					table.insert(stars, createStar())
				end
			end
		end

		-- å¤©é«”ç‰©ç†é‹ç®—
		for i = #stars, 1, -1 do
			local s = stars[i]
			s.Phi = s.Phi + s.Speed
			local starPos = rp + Vector3.new(
				s.Radius * math.sin(s.Theta) * math.cos(s.Phi),
				s.Radius * math.cos(s.Theta),
				s.Radius * math.sin(s.Theta) * math.sin(s.Phi)
			)
			s.Obj.Position = starPos
			-- ä¸‹æ–¹è¦–è·éæ¿¾
			s.Obj.Transparency = (starPos.Y < rp.Y - 5) and 1 or 0
		end
	end
end)
